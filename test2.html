<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ChickenPox - Procedural World</title>
    <link href="css/bootstrap-cyborg.css" rel="stylesheet">
    <link href="assets/icon.png" rel="shortcut icon">
</head>
<body>

    <div class="container">
<!--        <h1 class ="col-lg-offset-4 col-lg-6">Chicken Pox</h1>
        <hr/>
        <div class ="navbar">
            <ul class="nav nav-tabs col-lg-offset-3 col-lg-6">
                <li role="presentation"><a href="index.html">Home</a></li>
                <li role="presentation"><a href="test.html">Test - 1</a></li>
                <li role="presentation" class="active"><a href="test2.html">Test - 2</a></li>
            </ul>
        </div> -->
        <div  class="col-lg-offset-1 col-lg-10" id="game" />
    </div >

    <script type="text/javascript" src="js/phaser.min.js"></script>
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</body>
</html>


<script type="text/javascript">

    var game = new Phaser.Game(900, 500, Phaser.AUTO, 'game', { preload: preload, create: create, update: update });

    function preload() {

        game.load.image('star', 'assets/star.png');
        game.load.image('starsbg', 'assets/Background-2.jpg') // 2048 x 1536
        game.load.spritesheet('chicken', 'assets/chicken_spritesheet_75x90.png', 75, 90, 4, -5);
    }

    function create() {

        game.physics.startSystem(Phaser.Physics.NINJA);
        background = game.add.sprite(-400, -400, 'starsbg');
        game.physics.arcade.enable(background);


//        // Here we create the ground.
//        var ground = platforms.create(0, game.world.height, 'ground');
//        // var ground = platforms.create(0, game.world.height - 64, 'ground');
//
//        //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
//        // ground.scale.setTo(2, 2);
//
//        //  This stops it from falling away when you jump on it
//        ground.body.immovable = true;

        // The chicken and its settings
        chicken = game.add.sprite(game.world.width / 2, 0, 'chicken');

        //  We need to enable physics on the chicken
        game.physics.arcade.enable(chicken);

        //  chicken physics properties. Give the little guy a slight bounce.
        chicken.body.bounce.y = 0.2;
        chicken.body.gravity.y = 300;
//        chicken.body.collideWorldBounds = true;
        chicken.body.allowRotation = true;

        //  Our two animations, walking left and right.
        chicken.animations.add('left', [0, 3], 10, true);
        chicken.animations.add('right', [0, 3], 10, true);

        chicken.anchor.set(0.5)

//    chicken.body.drag.set(100);
//    chicken.body.maxVelocity.set(200);

        //  Finally some stars to collect
        stars = game.add.group();

        //  We will enable physics for any star that is created in this group
        // stars.enableBody = true;

        //  Here we'll create 12 of them evenly spaced apart
        for (var i = 0; i < 12; i++)
        {
            //  Create a star inside of the 'stars' group
            var star = stars.create(i * 70, 10+Math.random()*(game.world.height-20), 'star');

            //  Let gravity do its thing
            // star.body.gravity.y = 300;

            //  This just gives each star a slightly random bounce value
            // star.body.bounce.y = 0.7 + Math.random() * 0.2;
        }

        //  The score
        scoreText = game.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#FFF' });

        //  Our controls.
        cursors = game.input.keyboard.createCursorKeys();

    }

    function update() {

        //  Checks to see if the chicken overlaps with any of the stars, if he does call the collectStar function
        game.physics.arcade.overlap(chicken, stars, collectStar, null, this);

        //  Reset the chickens velocity (movement)
        chicken.body.velocity.x = 0;

        if (cursors.left.isDown)
        {
            //  Move to the left
            chicken.body.velocity.x = -150;
            chicken.body.velocity.y = -50;
            game.physics.arcade.accelerationFromRotation(chicken.rotation, 200, chicken.body.acceleration);
            chicken.body.angularVelocity = -200;
            chicken.animations.play('left');
        }
        else if (cursors.right.isDown)
        {
            //  Move to the right
            chicken.body.velocity.x = 150;
            chicken.body.velocity.y = -50;
            game.physics.arcade.accelerationFromRotation(chicken.rotation, 200, chicken.body.acceleration);
            chicken.body.angularVelocity = 200;
            chicken.animations.play('right');
        }
        else
        {
            //  Stand still
            chicken.animations.stop();
            //chicken.body.accelleration.set(0);
            scoreText.text = 'V = ' + chicken.body.angularVelocity + ' R: ' + chicken.rotation + ' A: ' + chicken.body.acceleration;
            chicken.body.angularVelocity -= (chicken.body.angularVelocity == 0) ? 0 : 2 * chicken.body.angularVelocity / Math.abs(chicken.body.angularVelocity)
            // chicken.body.angularVelocity = chicken.body.angularVelocity - 1
            chicken.frame = 4;
        }



        //  Allow the chicken to jump if they are touching the ground.
//    if (cursors.up.isDown && chicken.body.touching.down)
        if (cursors.up.isDown)
        {

        }

        updateBackground(chicken, background);

        screenWrap(chicken)
    }

    function updateBackground(chicken, background){

        background.body.velocity.x =  - chicken.body.velocity.x / 100;
        background.body.velocity.y = - chicken.body.velocity.y / 100;

    }

    function collectStar (chicken, star) {

        // Removes the star from the screen
        star.kill();

        //  Add and update the score
        score += 10;
        scoreText.text = 'Score: ' + score;

    }

    function screenWrap (sprite) {

        if (sprite.x < 0)
        {
            sprite.x = game.width;
        }
        else if (sprite.x > game.width)
        {
            sprite.x = 0;
        }

        if (sprite.y < 0)
        {
            sprite.y = game.height;
        }
        else if (sprite.y > game.height)
        {
            sprite.y = 0;
        }

    }

</script>