<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ChickenPox - Procedural World</title>
    <link href="css/bootstrap-cyborg.css" rel="stylesheet">
    <link href="assets/icon.png" rel="shortcut icon">
</head>
<body>

    <div class="container">
<!--        <h1 class ="col-lg-offset-4 col-lg-6">Chicken Pox</h1>
        <hr/>
        <div class ="navbar">
            <ul class="nav nav-tabs col-lg-offset-3 col-lg-6">
                <li role="presentation"><a href="index.html">Home</a></li>
                <li role="presentation"><a href="test.html">Test - 1</a></li>
                <li role="presentation" class="active"><a href="test2.html">Test - 2</a></li>
            </ul>
        </div> -->
        <div  class="col-lg-offset-1 col-lg-10" id="game" />
    </div >

    <script type="text/javascript" src="js/phaser.min.js"></script>
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</body>
</html>


<script type="text/javascript">

    var game = new Phaser.Game(900, 500, Phaser.AUTO, 'game', { preload: preload, create: create, update: update });
    var planetSprites = [ { sheet:'sm_planet',  frames: 784, size:25, assets:'assets/planet_background1.png'},
        { sheet:'med_planet', frames: 196, size:50, assets:'assets/planet_background1.png'},
        { sheet:'lg_planet',  frames:  49, size:100, assets:'assets/planet_background1.png'}]

    var planetGroup;

    function preload() {

        for(i = 0; i < planetSprites.length; i++){
            game.load.spritesheet(planetSprites[i].sheet, planetSprites[i].assets, planetSprites[i].size, planetSprites[i].size);
        }

        game.load.image('star', 'assets/star.png');
        game.load.image('starsbg', 'assets/Background-2.jpg') // 2048 x 1536
        game.load.image('stars', 'assets/starsglow1.gif') // 2048 x 1536
        game.load.spritesheet('chicken', 'assets/chicken_spritesheet_75x90.png', 75, 90, 4, -5);
    }

    function create() {

        game.stage.backgroundColor = '#2d2d2d';
        game.physics.startSystem(Phaser.Physics.NINJA);


        bgtile = game.add.tileSprite(0, 0, game.stage.bounds.width, game.stage.bounds.height, 'stars');

//        game.add.tileSprite(0, 0, 200, 200, 'stars');
        game.world.setBounds(0, 0, 2000, 2000);
        planetGroup = game.add.group();

        for(i = 0; i < randomNum(100)+50; i++){
            newPlanet(game);
        }

//        game.physics.startSystem(Phaser.Physics.P2JS);

//        player = game.add.sprite(game.world.centerX, game.world.centerY, 'player');

//        game.physics.p2.enable(player);

//        cursors = game.input.keyboard.createCursorKeys();

//        game.camera.follow(player);



        upKey = game.input.keyboard.addKey(Phaser.Keyboard.UP);
    }



    function update() {
        bgtile.tilePosition.x -= randomNum(3);
        bgtile.tilePosition.y -= randomNum(3);

//        planetGroup.x -= randomNum(3) - 1;
//
//        planetGroup.y -= randomNum(3) - 1;

        planetGroup.forEach(function(planet) {

//            planet.x -= randomNum(3) - 1;
//            planet.y -= randomNum(3) - 1;

            planet.mask.clear();

            planet.mask.beginFill(0xffffff);
            planet.mask.drawCircle(planet.x + planet.height / 2,
                    planet.y + planet.width / 2,
                    planet.height / 2);



        });


    }

    function randomNum(x){
        return Math.floor((Math.random() * x));
    }



    function redrawMask(planet){

        planet.mask = null;

        planetMask = game.add.graphics(0, 0);
        planet.mask = planetMask;
        planet.mask.beginFill(0xffffff);
        planet.mask.drawCircle(planet.position.x + planet.height / 3,
                planet.position.y + planet.height / 3,
                planet.height / 3);

    }

    function newPlanet(game){
        planetX = randomNum(game.world.width);
        planetY = randomNum(game.world.height);

        choice = randomNum(planetSprites.length);

        planet = planetGroup.create(planetX, planetY, planetSprites[choice].sheet);
        planet.frame = randomNum(planet.animations.frameTotal);

        planet.tint = Math.random() * 0xffffff;

        planetMask = game.add.graphics(0, 0);
//
//            //	Shapes drawn to the Graphics object must be filled.
        planetMask.beginFill(0xffffff);
//
//            //	Here we'll draw a circle
        planetMask.drawCircle(planetX + planetSprites[choice].size / 3,
                planetY + planetSprites[choice].size / 3,
                planetSprites[choice].size / 3);
//
//            //	And apply it to the Sprite
        planet.mask = planetMask;
        game.physics.arcade.enable(planet);
        planet.body.velocity.x = randomNum(10);
        planet.body.velocity.y = randomNum(10);
    }

</script>